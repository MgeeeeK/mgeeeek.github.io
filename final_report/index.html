<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>GSoC2020 Project Report - MgeeeeK Home</title><meta name="Description" content="About LoveIt Theme"><meta property="og:title" content="GSoC2020 Project Report" />
<meta property="og:description" content="Project Details    Field Value     Project Title Raster Awareness in PySAL   Project Link https://summerofcode.withgoogle.com/projects/#5775104799145984   Organization NumFOCUS (Sub-Org: PySAL)   Mentors Stefanie Lumnitz, Dani Arribas-Bel, Levi John Wolf   Contributed Repo libpysal, splot   Working Repo Mgeeeek/libpysal   Gitter Room https://gitter.im/GSoC2020-PySAL/Raster_awareness_in_PySAL   Project Blog https://mgeeeek.github.io/tags/gsoc/    Project Description From early on, PySAL was designed with the focus of performing vector-based spatial analysis and therefore it didn&rsquo;t have tools to handle input-output of large raster data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mgeeeek.github.io/final_report/" /><meta property="og:image" content="https://mgeeeek.github.io/final_report/featured-image.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-30T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-08-30T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://mgeeeek.github.io/final_report/featured-image.png"/>
<meta name="twitter:title" content="GSoC2020 Project Report"/>
<meta name="twitter:description" content="Project Details    Field Value     Project Title Raster Awareness in PySAL   Project Link https://summerofcode.withgoogle.com/projects/#5775104799145984   Organization NumFOCUS (Sub-Org: PySAL)   Mentors Stefanie Lumnitz, Dani Arribas-Bel, Levi John Wolf   Contributed Repo libpysal, splot   Working Repo Mgeeeek/libpysal   Gitter Room https://gitter.im/GSoC2020-PySAL/Raster_awareness_in_PySAL   Project Blog https://mgeeeek.github.io/tags/gsoc/    Project Description From early on, PySAL was designed with the focus of performing vector-based spatial analysis and therefore it didn&rsquo;t have tools to handle input-output of large raster data."/>
<meta name="application-name" content="$ cd $HOME">
<meta name="apple-mobile-web-app-title" content="$ cd $HOME"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://mgeeeek.github.io/final_report/" /><link rel="prev" href="https://mgeeeek.github.io/cdp31/" /><link rel="next" href="https://mgeeeek.github.io/sum_with_amz_and_arviz/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "GSoC2020 Project Report",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/mgeeeek.github.io\/final_report\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/mgeeeek.github.io\/final_report\/featured-image.png",
                            "width":  1000 ,
                            "height":  500 
                        }],"genre": "posts","keywords": "pysal, final report","wordcount":  3463 ,
        "url": "https:\/\/mgeeeek.github.io\/final_report\/","datePublished": "2020-08-30T00:00:00+00:00","dateModified": "2020-08-30T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/mgeeeek.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Mragank Shekhar"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="MgeeeeK Home"><span class="header-title-pre"><i class='fas fa-dollar-sign fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://drive.google.com/file/d/1-7vJVZcDqpWzYJ2OVWVHv7rgiKUJCqTg/view" rel="noopener noreffer" target="_blank"> Resume </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="MgeeeeK Home"><span class="header-title-pre"><i class='fas fa-dollar-sign fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://drive.google.com/file/d/1-7vJVZcDqpWzYJ2OVWVHv7rgiKUJCqTg/view" title="" rel="noopener noreffer" target="_blank">Resume</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">GSoC2020 Project Report</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/MgeeeeK" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Mragank Shekhar</a></span>&nbsp;<span class="post-category">included in <a href="/categories/gsoc20/"><i class="far fa-folder fa-fw"></i>gsoc20</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="30-08-2020">30-08-2020</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;3463 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;17 minutes&nbsp;<span id="/final_report/" class="leancloud_visitors" data-flag-title="GSoC2020 Project Report">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/final_report/featured-image.png"
        data-srcset="/final_report/featured-image.png, /final_report/featured-image.png 1.5x, /final_report/featured-image.png 2x"
        data-sizes="auto"
        alt="/final_report/featured-image.png"
        title="/final_report/featured-image.png" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#project-details">Project Details</a></li>
    <li><a href="#project-description">Project Description</a>
      <ul>
        <li><a href="#api-design-phase">API design phase</a>
          <ul>
            <li><a href="#io-dependency-for-accessing-raster">I/O dependency for accessing raster</a></li>
            <li><a href="#planning-main-functionality-for-the-interface">Planning main functionality for the interface</a></li>
            <li><a href="#designing-interfaces-api-_weights-builder_">Designing interface&rsquo;s API (<em>weights builder</em>)</a></li>
            <li><a href="#designing-interfaces-api-_return-journey-to-xarraydataarray_">Designing interface&rsquo;s API (<em>return journey to <code>xarray.DataArray</code></em>)</a></li>
            <li><a href="#iterative-approach-for-api-design">Iterative approach for API design</a></li>
          </ul>
        </li>
        <li><a href="#integration-phase">Integration phase</a>
          <ul>
            <li><a href="#refactoring-weights-object">Refactoring weights object</a></li>
            <li><a href="#refactoring-todataarray-method-making-it-work-with-only-weights-object-and-independent-of-metadata">Refactoring <code>toDataArray</code> method, making it work with only weights object and independent of metadata</a></li>
            <li><a href="#adding-distance-based-weights-object-support">Adding distance-based weights object support</a></li>
            <li><a href="#adding-tests-documentation-example-notebook-and-finalizing-base-raster-interface">Adding tests, documentation, example notebook, and finalizing base raster interface</a></li>
            <li><a href="#identifying-areas-to-optimize-for-adding-support-for-large-rasters">Identifying areas to optimize for adding support for large rasters.</a></li>
          </ul>
        </li>
        <li><a href="#optimization-phase">Optimization phase</a>
          <ul>
            <li><a href="#moving-on-from-lat2sw-based-which-uses-dia_matrix-to-new-coo_matrix-based-sparse-weight-builder">Moving on from <code>lat2SW</code>-based (which uses <code>dia_matrix</code>) to new <code>coo_matrix</code>-based sparse weight builder</a></li>
            <li><a href="#optimizing-the-addition-of-higher-order-neighbors">Optimizing the addition of higher-order neighbors</a></li>
            <li><a href="#adding-visualization-support-for-the-interface">Adding visualization support for the interface.</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#next-phase-post-gsoc">Next Phase (post-gsoc)</a></li>
    <li><a href="#huge-thanks-to-pysal-community">Huge thanks to PySAL Community</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="project-details">Project Details</h2>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Project Title</em></td>
<td>Raster Awareness in PySAL</td>
</tr>
<tr>
<td><em>Project Link</em></td>
<td><a href="https://summerofcode.withgoogle.com/projects/#5775104799145984">https://summerofcode.withgoogle.com/projects/#5775104799145984</a></td>
</tr>
<tr>
<td><em>Organization</em></td>
<td><a href="https://numfocus.org/" target="_blank" rel="noopener noreffer">NumFOCUS</a> (Sub-Org: <a href="http://pysal.org/pysal" target="_blank" rel="noopener noreffer">PySAL</a>)</td>
</tr>
<tr>
<td><em>Mentors</em></td>
<td><a href="https://github.com/slumnitz" target="_blank" rel="noopener noreffer">Stefanie Lumnitz</a>, <a href="https://github.com/darribas" target="_blank" rel="noopener noreffer">Dani Arribas-Bel</a>, <a href="https://github.com/ljwolf" target="_blank" rel="noopener noreffer">Levi John Wolf</a></td>
</tr>
<tr>
<td><em>Contributed Repo</em></td>
<td><a href="https://github.com/pysal/libpysal" target="_blank" rel="noopener noreffer">libpysal</a>, <a href="https://github.com/pysal/splot" target="_blank" rel="noopener noreffer">splot</a></td>
</tr>
<tr>
<td><em>Working Repo</em></td>
<td><a href="https://github.com/MgeeeeK/libpysal" target="_blank" rel="noopener noreffer">Mgeeeek/libpysal</a></td>
</tr>
<tr>
<td><em>Gitter Room</em></td>
<td><a href="https://gitter.im/GSoC2020-PySAL/Raster_awareness_in_PySAL">https://gitter.im/GSoC2020-PySAL/Raster_awareness_in_PySAL</a></td>
</tr>
<tr>
<td><em>Project Blog</em></td>
<td><a href="https://mgeeeek.github.io/tags/gsoc/">https://mgeeeek.github.io/tags/gsoc/</a></td>
</tr>
</tbody>
</table>
<h2 id="project-description">Project Description</h2>
<p>From early on, <code>PySAL</code> was designed with the focus of performing vector-based spatial analysis and therefore it didn&rsquo;t have tools to handle input-output of large raster data. This restricted some folks in the geospatial community to use <code>PySAL</code>&rsquo;s analytical functionality over raster data. Furthermore, in recent years several geographic data organizations started releasing data in raster format which earlier came in vector format mostly because of advancement in computational capabilities and high storage availability. This led to an increase in the demand for the functionality offered by <code>PySAL</code> to make it work with raster data.</p>
<p>Taking this into consideration, my main motive was to design and implement a lightweight interface which will provide the functionality for streamlining raster data access and making it more accessible to build the data structure accepted by the analytical methods of the PySAL library (mainly <code>libpysal.weights.W/WSP</code> objects) from accessed raster data (which will be an instance of <code>xarray.DataArray</code>). Ultimately, this functionality will open up the use of analytical methods like <code>esda</code>, <code>spatial regression</code> over raster data.</p>
<p>Following were the major milestones that we planned to finish for successfully building raster interface:</p>
<ul>
<li>Design quality APIs which followed existing structure used across PySAL.</li>
<li>Deal with different properties of raster including missing data values, different data alignment, and multi-layer data.</li>
<li>Add transformational methods to support conversion to and from PySAL weights object and <code>xarray.DataArray</code> object.</li>
<li>Integrate the interface with PySAL without causing any disturbance to other parts of the library.</li>
<li>Study performance and memory efficiency of the conversion methods and optimize the interface to support computations for large raster datasets.</li>
<li>Add proper documentation, tests, and an example notebook.</li>
</ul>
<p>Since in this report we&rsquo;ll talk a lot about raster data and weights object, let&rsquo;s look at the visualization of these 2 things. Weights object in <code>PySAL</code> is a graph like structure which expresses the relationship of a spatial point with its neighboring points. We can now take a look at the visual example below:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/40512095/91647853-83b96b80-ea7d-11ea-8002-641ce7dc621d.png"
        data-srcset="https://user-images.githubusercontent.com/40512095/91647853-83b96b80-ea7d-11ea-8002-641ce7dc621d.png, https://user-images.githubusercontent.com/40512095/91647853-83b96b80-ea7d-11ea-8002-641ce7dc621d.png 1.5x, https://user-images.githubusercontent.com/40512095/91647853-83b96b80-ea7d-11ea-8002-641ce7dc621d.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/40512095/91647853-83b96b80-ea7d-11ea-8002-641ce7dc621d.png"
        title="Fig. 1" />
<em>This figure consist of 2 plots of weights object (which are listed below) and 2 of raster data. These weights objects were obtained using a sliced raster. We can see the relationship of spatial points is different in <code>Rook</code> and <code>Queen</code> contiguity, interface dealt with <code>nodatavals</code> while creating the weights object thats why we are seeing those empty pixels.</em><br>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/40512095/91647893-325dac00-ea7e-11ea-84d3-ac6882fc5231.png"
        data-srcset="https://user-images.githubusercontent.com/40512095/91647893-325dac00-ea7e-11ea-84d3-ac6882fc5231.png, https://user-images.githubusercontent.com/40512095/91647893-325dac00-ea7e-11ea-84d3-ac6882fc5231.png 1.5x, https://user-images.githubusercontent.com/40512095/91647893-325dac00-ea7e-11ea-84d3-ac6882fc5231.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/40512095/91647893-325dac00-ea7e-11ea-84d3-ac6882fc5231.png"
        title="Fig. 2" /></p>
<p><em>The development timeline for building the project was divided into 3 phases:</em></p>
<ol>
<li><em>API design phase</em></li>
<li><em>Integration phase</em></li>
<li><em>Optimization phase</em></li>
</ol>
<h3 id="api-design-phase">API design phase</h3>
<p><strong>Quick Overview</strong></p>
<p>Main goals achieved:</p>
<ul>
<li>Studied data structures provided by <code>xarray</code> and PySAL&rsquo;s <code>W</code> and <code>WSP</code> objects.</li>
<li>Created an initial skeletal implementation of the interface.</li>
<li>Iteratively designed and experimented with different APIs structures.</li>
<li>Created a working prototype of the Base Raster Interface.</li>
</ul>
<p>Pull Requests, Commits and Issues created:</p>
<ul>
<li><strong>Issue:</strong> <strong>[open]</strong> <a href="https://github.com/pysal/libpysal/issues/293#issue-629986294" target="_blank" rel="noopener noreffer">Idea collection/discussion for Raster awareness project</a></li>
<li><strong>Commit:</strong> <a href="https://github.com/MgeeeeK/libpysal/commit/9eb8311605bba5f942678d7694edcc746b7ce6ee" target="_blank" rel="noopener noreffer">final API with working prototype</a></li>
</ul>
<p>Blog posts published:</p>
<ul>
<li><a href="https://mgeeeek.github.io/posts/2020/06/coding-period-first-phase-part-1/" target="_blank" rel="noopener noreffer">Coding Period: First Phase Part 1</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/06/coding-period-first-phase-part-2/" target="_blank" rel="noopener noreffer">Coding Period: First Phase Part 2</a></li>
</ul>
<p>Contents:</p>
<ol>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#io-dependency-for-accessing-raster" target="_blank" rel="noopener noreffer">I/O dependency for accessing raster</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#planning-main-functionality-for-the-interface" target="_blank" rel="noopener noreffer">Planning main functionality for the interface</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#designing-interfaces-api-weights-builder" target="_blank" rel="noopener noreffer">Designing interface&rsquo;s API (<em>weights builder</em>)</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#designing-interfaces-api-return-journey-to-xarraydataarray" target="_blank" rel="noopener noreffer">Designing interface&rsquo;s API (<em>return journey to <code>xarray.DataArray</code></em>)</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#iterative-approach-for-api-design" target="_blank" rel="noopener noreffer">Iterative approach for API design</a></li>
</ol>
<p><strong>Detailed Summary</strong></p>
<ol>
<li>
<h4 id="io-dependency-for-accessing-raster">I/O dependency for accessing raster</h4>
<p>The original plan involved using <code>rasterio</code> as the main library for raster data access but from the start of the community bonding period, my mentors suggested a shift from <code>rasterio</code> to <code>xarray</code>. After going through the documentation of <code>xarray</code> it felt superior in terms of usability and accessibility as the features it provided outweighed that of <code>rasterio</code> and it also featured <code>rasterio</code> backend to access the raster data formats easily. Moreover, building the interface to work with the data structure provided by the <code>xarray</code> library made the project available to a broader audience. Therefore I continued with the <code>xarray</code> or <code>xarray.DataArray</code> to be specific, as users can easily obtain <code>xarray.DataArray</code> object from raster data format using <code>xarray</code>&rsquo;s I/O functionality which can read from a variety of data formats some of them are listed below:</p>
<ul>
<li><a href="https://svn.osgeo.org/gdal/tags/gdal_1_2_5/frmts/formats_list.html" target="_blank" rel="noopener noreffer">GDAL Raster Formats</a> via <code>open_rasterio</code> method.</li>
<li><a href="https://www.unidata.ucar.edu/software/netcdf/" target="_blank" rel="noopener noreffer">NetCDF</a> via <code>open_dataset</code> method.</li>
</ul>
</li>
<li>
<h4 id="planning-main-functionality-for-the-interface">Planning main functionality for the interface</h4>
<p>After understanding the structure of <code>xarray.DataArray</code>, it was time to create an initial skeletal implementation of the interface which provided details of the functionality that the interface will offer. As described by Dani in this <a href="https://github.com/pysal/libpysal/issues/293#issuecomment-638446405" target="_blank" rel="noopener noreffer">thread</a>:</p>
<ul>
<li>The interface would provide the functionality to create both weights object <code>libpysal.weights.W</code> &amp; <code>WSP</code> from user-provided data though <code>xarray.DataArray</code> object.</li>
<li>It should also support the return journey of the data obtained after an analytical operation on the weights object to <code>xarray.DataArray</code>.</li>
</ul>
</li>
<li>
<h4 id="designing-interfaces-api-_weights-builder_">Designing interface&rsquo;s API (<em>weights builder</em>)</h4>
<p>Once the main functionality was finalized, we jumped on to the API designing part of the project. My mentors explained how PySAL was inclined towards an object-oriented paradigm and the majority of the operations are achieved through creating an instance of a particular object using the class method and then calling the instance method. But it was also in the transitioning phase of incorporating functional programming though it was not on the top of their priority list. This motivated us to provide the functionality of direct function calling to convert <code>DataArray</code> and create respective weights object, but also implement these methods as a class method using contiguity classes (<code>Rook</code> and <code>Queen</code>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">libpysal.weights</span> <span class="kn">import</span> <span class="n">raster</span><span class="p">,</span> <span class="n">Rook</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="kn">as</span> <span class="nn">xr</span>

<span class="c1"># Accessing raster data using xarray</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="s2">&#34;raster.tif&#34;</span><span class="p">)</span>

<span class="c1"># Method 1</span>
<span class="n">wsp1</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">da2WSP</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&#34;rook&#34;</span><span class="p">)</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_series</span><span class="p">()[</span><span class="n">wsp1</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="c1"># Method 2</span>
<span class="n">wsp2</span> <span class="o">=</span> <span class="n">Rook</span><span class="o">.</span><span class="n">from_xarray</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_series</span><span class="p">()[</span><span class="n">wsp2</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="n">data1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>True
</code></pre>
</li>
<li>
<h4 id="designing-interfaces-api-_return-journey-to-xarraydataarray_">Designing interface&rsquo;s API (<em>return journey to <code>xarray.DataArray</code></em>)</h4>
<p>In the above example, <code>.from_xarray</code> method uses direct methods like <code>da2W</code> or <code>da2WSP</code> under the hood to build weights object from <code>xarray.DataArray</code>. A new module called <code>raster</code> was introduced to hold all the functionalities offered by the interface, it also helped in structuring the interface by separating it with other areas of the library. Just like what we saw with <code>.from_xarray</code> method, all the work related to the raster conversion is dispatched to one of the methods in the <code>raster</code> module.</p>
<p>A similar approach was taken for designing the API for the return journey. We implemented 2 types of methods:</p>
<ul>
<li><code>toDataArray</code> which can be called directly.</li>
<li>Another way was to call the instance method <code>.to_xarray</code> which provided similar functionality to the direct methods.</li>
</ul>
<p>In the later phase, <code>.to_xarray</code> method was removed due to several limitations because the structure of created weights object was different from the normal ones (more on this later), and therefore these methods would fail if the user passed the weights object not created using the interface.</p>
</li>
<li>
<h4 id="iterative-approach-for-api-design">Iterative approach for API design</h4>
<p>It took quite a few iterations to finalize the correct API of the base interface. Below are the early pull requests that I pushed to get feedbacks for the API of the transformational functions. These are far from clean as I was still experimenting with different design decisions.</p>
<ul>
<li><strong>PR:</strong> [<strong>Closed</strong>] <a href="https://github.com/MgeeeeK/libpysal/pull/1" target="_blank" rel="noopener noreffer">Raster Interface v1</a></li>
<li><strong>PR:</strong> [<strong>Closed</strong>] <a href="https://github.com/MgeeeeK/libpysal/pull/3" target="_blank" rel="noopener noreffer">Raster Interface v2</a></li>
<li><strong>PR:</strong> [<strong>Closed</strong>] <a href="https://github.com/MgeeeeK/libpysal/pull/4" target="_blank" rel="noopener noreffer">Raster Interface v3</a></li>
</ul>
<p>Commit <a href="https://github.com/MgeeeeK/libpysal/commit/9eb8311605bba5f942678d7694edcc746b7ce6ee" target="_blank" rel="noopener noreffer">9eb8311</a> was the point of the 1st phase where the majority of the APIs were locked. There were still some areas left where the community was divided particularly in structuring and naming the parameters of the methods, but these were minor issues that were solved in the later stages.</p>
</li>
</ol>
<h3 id="integration-phase">Integration phase</h3>
<p><strong>Quick Overview</strong></p>
<p>Main goals achieved:</p>
<ul>
<li>Restructured interface by aligning the methods with future weights object design.</li>
<li>Made <code>toDataArray</code> method work independent of raster metadata.</li>
<li>Added <code>KNN</code> weights support to the interface.</li>
<li>Fixed documentation, by following the NumPy-Doc convention for docstrings.</li>
<li>Added unit-tests and an example notebook.</li>
<li>Explored different ways to optimize the interface.</li>
</ul>
<p>Pull Requests, Commits and Issues created:</p>
<ul>
<li><strong>PR:</strong> <strong>[merged]</strong> <a href="https://github.com/pysal/libpysal/pull/318" target="_blank" rel="noopener noreffer">Base raster interface</a></li>
<li><strong>Issue:</strong> <strong>[open]</strong> <a href="https://github.com/pysal/libpysal/issues/293#issuecomment-651636142" target="_blank" rel="noopener noreffer">Idea collection/discussion for Raster awareness project</a></li>
</ul>
<p>Blog posts published:</p>
<ul>
<li><a href="https://mgeeeek.github.io/posts/2020/07/coding-period-second-phase-part-1/" target="_blank" rel="noopener noreffer">Coding Period: Second Phase Part 1</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/07/coding-period-second-phase-part-2/" target="_blank" rel="noopener noreffer">Coding Period: Second Phase Part 2</a></li>
</ul>
<p>Contents:</p>
<ol>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#refactoring-weights-object" target="_blank" rel="noopener noreffer">Refactoring weights object</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#refactoring-todataarray-method-making-it-work-with-only-weights-object-and-independent-of-metadata" target="_blank" rel="noopener noreffer">Refactoring <code>toDataArray</code> method</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#adding-distance-based-weights-object-support" target="_blank" rel="noopener noreffer">Adding distance-based weights object support</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#adding-tests-documentation-example-notebook-and-finalizing-base-raster-interface" target="_blank" rel="noopener noreffer">Finalzing base raster interface</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#identifying-areas-to-optimize-for-adding-support-for-large-rasters" target="_blank" rel="noopener noreffer">Identifying areas to optimize</a></li>
</ol>
<p><strong>Detailed Summary</strong></p>
<ol>
<li>
<h4 id="refactoring-weights-object">Refactoring weights object</h4>
<p>In the second phase, we focused on how to integrate the interface with the libpysal. One major issue related to the integration was that the output weights of the transformation methods (<code>da2W</code>/<code>da2WSP</code>) were different from the normal weights object, this was due to the extra attributes added to the weights object namely <code>attrs</code> and <code>coords</code>. This addition was implemented in the builder method to make the weights object more interactable with <code>xarray.DataArray</code> as the user will want to access the raster data easily after building the weights from the DataArray. Therefore <code>coords</code> attribute stored the coordinates indices of non-missing values in the form of <code>pandas.MultiIndex</code>, and <code>attrs</code> stored the metadata which was required when going back to the <code>xarray.DataArray</code>. This issue was addressed in the community meeting. After a detailed meeting with community members regarding the weights object, one of the major change that was proposed was to shift towards <code>WSP</code> object (here are the <a href="https://hackmd.io/Fozkz1IRQlK6GYVKI8mF9Q?both" target="_blank" rel="noopener noreffer">meeting notes</a>). Additionally, the <code>id_order</code> attribute will be replaced by <code>index</code> which will contain an instance of <code>pandas.Index</code> aligned with the <code>ids</code> of the weight object.</p>
<p>This required a few changes in my existing implementation:</p>
<ul>
<li>Renamed <code>coords</code> to <code>index</code> and removed <code>attrs</code> attribute.</li>
<li>Added <code>index</code> parameter in the <code>__init__</code> method of <code>WSP</code> class.</li>
<li>Fixed creation of <code>W</code> from <code>xarray.DataArray</code> which now only relies on <code>da2WSP</code> method.</li>
</ul>
</li>
<li>
<h4 id="refactoring-todataarray-method-making-it-work-with-only-weights-object-and-independent-of-metadata">Refactoring <code>toDataArray</code> method, making it work with only weights object and independent of metadata</h4>
<p>A few of the major changes added during the second phase involved the <code>toDataArray</code> method. To make the interface more accessible we decided to only build the <code>DataArray</code> from <em>weights object</em> and <em>data values aligned to the weights object</em>. This was tricky as the weights object does not contain any information related to the missing values except the coordinates in the <code>index</code> attribute. After several tries of my own, I shifted towards the source code of the <code>pandas.MultiIndex</code>. From my earlier impressions, the data structure of <code>pandas.MultiIndex</code> was very different. Once I understood the architecture of <code>pandas.MultiIndex</code> I pushed a patch with the required changes, this patch refactored the logic and used the <code>codes</code> and <code>levels</code> property to construct all the coordinates of the <code>DataArray</code>. Commit <a href="https://github.com/MgeeeeK/libpysal/commit/e5cd4e69cbc840fb9eb229e31f126068efd476af" target="_blank" rel="noopener noreffer">e5cd4e6</a> reflects the changes made targeting this method. Later <code>toDataArray</code> was split into 2 separate functions <code>w2da</code> and <code>wsp2da</code>. We can see the use of this functionality below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">libpysal.weights</span> <span class="kn">import</span> <span class="n">raster</span><span class="p">,</span> <span class="n">Queen</span>

<span class="c1"># Creating test DataArray</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">testDataArray</span><span class="p">(</span>
    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">49</span><span class="p">),</span>
    <span class="n">time</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">rand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">missing_vals</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="n">wsp</span> <span class="o">=</span> <span class="n">Queen</span><span class="o">.</span><span class="n">from_xarray</span><span class="p">(</span>
    <span class="n">da</span><span class="o">=</span><span class="n">da</span><span class="p">,</span>
    <span class="n">z_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">coords_label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">sparse</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="c1"># Accessing data from da using index attribute</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_series</span><span class="p">()[</span><span class="n">wsp</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="c1"># Converting back to the DataArray</span>
<span class="n">da_back</span> <span class="o">=</span> <span class="n">wsp2da</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">wsp</span><span class="p">)</span>
<span class="n">da_back</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>&lt;xarray.DataArray (band: 1, y: 56, x: 49)&gt;
-1 211 -1 -1 -1 41 37 -1 62 -1 ... -1 171 118 135 28 151 -1 -1 -1 146
Coordinates:
* band     (band) int64 5
* y        (y) float64 66.1 66.2 66.3 66.4 66.5 ... 71.2 71.3 71.4 71.5 71.6
* x        (x) float64 92.1 92.2 92.3 92.4 92.5 ... 96.5 96.6 96.7 96.8 96.9
Attributes:
    nodatavals:  (-1,)
</code></pre>
</li>
<li>
<h4 id="adding-distance-based-weights-object-support">Adding distance-based weights object support</h4>
<p><code>Rook</code> and <code>Queen</code> contiguities were not sufficient when considered for further analysis on a raster data because <code>Rook</code> contiguity provided max 4 neighbors and <code>Queen</code> provided max 8. To tackle this, the next step was to implement distance weight builder either <code>KNN</code> or <code>DistanceBand</code>. We started with <code>KNN</code>, the initial implementation of <code>KNN</code> was very straight forward, we first converted cell centroids into points and then shipped them directly into the <code>KNN</code> builder which is based on <code>KDTree</code>. There were 2 major issues with this implementation first was very obvious as raster provided a regular lattice-like structure, <code>KNN</code> could have been more optimized since there was no need for building <code>KDTree</code>. Though the major issue was related to the ordering of the selected neighbors. Since in raster more than 2 neighbors can be equidistant from the focal point, the method inconsistently selected neighbors in a different environment. Therefore this was later removed from the project.</p>
</li>
<li>
<h4 id="adding-tests-documentation-example-notebook-and-finalizing-base-raster-interface">Adding tests, documentation, example notebook, and finalizing base raster interface</h4>
<p>Once all the components of the base raster Interface were finalized, we started working on the documentation and tests. From the beginning I followed the style of other methods inside libpysal when creating docstrings, luckily my mentors notified me early on to follow NumPy-Doc convention for docstrings. After fixing docstring we worked on adding unit-tests since we were not storing any raster dataset inside the project therefore we decided to create a <code>testDataArray</code> method (usage provided in the above example) which provided us with the different dataset to test interface correctly.</p>
<p>I also added an example notebook that introduced the API of the interface and gave a brief overview of its use-case in different scenarios. The notebook can be accessed from here:</p>
<ul>
<li><a href="https://github.com/MgeeeeK/libpysal/blob/rast_interface/notebooks/Raster_awareness_API.ipynb" target="_blank" rel="noopener noreffer">Example Notebook</a></li>
</ul>
<p>Commits <a href="https://github.com/MgeeeeK/libpysal/commit/6565dd0f84768203a1c5f5cd2833cf91d6f30af3" target="_blank" rel="noopener noreffer">6565dd0</a> to <a href="https://github.com/MgeeeeK/libpysal/commit/94ec4f4bc9746a235cbaa3486d06b33d76350249" target="_blank" rel="noopener noreffer">94ec4f4</a> contains the majority of work finalized in the second phase. Since the main API of the base interface was finalized, I created a pull request targeting the master branch of libpysal:</p>
<ul>
<li><strong>PR:</strong> <strong>[merged]</strong> <a href="https://github.com/pysal/libpysal/pull/318" target="_blank" rel="noopener noreffer">Base raster interface</a></li>
</ul>
<p><strong>Note:</strong> All my main work for the <em>first</em> and <em>second</em> phase lives inside this pull request. The commit history doesn&rsquo;t look clean as for some reason I forced pushed a few changes.</p>
</li>
<li>
<h4 id="identifying-areas-to-optimize-for-adding-support-for-large-rasters">Identifying areas to optimize for adding support for large rasters.</h4>
<p>Along with working on the interface we were also identifying and exploring the different optimization methods to optimize the interface. This thread documents list of ideas we went through during exploration.</p>
<ul>
<li><a href="https://github.com/pysal/libpysal/issues/293#issuecomment-651636142" target="_blank" rel="noopener noreffer">Idea collection for Raster awareness project</a></li>
</ul>
</li>
</ol>
<h3 id="optimization-phase">Optimization phase</h3>
<p><strong>Quick Overview</strong></p>
<p>Main goals achieved:</p>
<ul>
<li>Shifted away from <code>lat2SW</code>-based weight builder.</li>
<li>Redesigned sparse matrix builder based on <code>COO_matrix</code>.</li>
<li>Numba-fied all possible methods using <code>njit</code> decorator.</li>
<li>Added multi-threaded implementation for WSP builder using <code>joblib</code>.</li>
<li>Added <code>higher_order</code> functionality to the modified weight builder.</li>
<li>Added raster-based weights object support inside <code>plot_spatial_weights</code> method in <code>splot</code>.</li>
</ul>
<p>Pull Requests, Commits and Issues created:</p>
<ul>
<li><strong>PR:</strong> <strong>[WIP]</strong> <a href="https://github.com/pysal/libpysal/pull/343" target="_blank" rel="noopener noreffer">Optimized raster-based weights builder</a></li>
<li><strong>PR:</strong> <strong>[WIP]</strong> <a href="https://github.com/pysal/splot/pull/113" target="_blank" rel="noopener noreffer">Added raster weights plotting functionality</a></li>
<li><strong>Issue:</strong> <strong>[open]</strong> <a href="https://github.com/pysal/libpysal/issues/328" target="_blank" rel="noopener noreffer">Distance Band functionality for Raster Interface weights</a></li>
<li><strong>Issue:</strong> <strong>[open]</strong> <a href="https://github.com/pysal/splot/issues/112" target="_blank" rel="noopener noreffer">plotting for <code>libpysal</code> raster functionality</a></li>
</ul>
<p>Blog posts published:</p>
<ul>
<li><a href="https://mgeeeek.github.io/posts/2020/08/coding-period-last-phase-part-1/" target="_blank" rel="noopener noreffer">Coding Period: Last Phase Part 1</a>.</li>
</ul>
<p>Contents:</p>
<ol>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#moving-on-from-lat2sw-based-which-uses-dia_matrix-to-new-coo_matrix-based-sparse-weight-builder" target="_blank" rel="noopener noreffer">Moving on from <code>lat2SW</code>-based sparse weight builder</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#optimizing-the-addition-of-higher-order-neighbors" target="_blank" rel="noopener noreffer">Optimizing the addition of higher-order neighbors</a></li>
<li><a href="https://mgeeeek.github.io/posts/2020/08/gsoc2020-project-report#adding-visualization-support-for-the-interface" target="_blank" rel="noopener noreffer">Adding visualization support for the interface</a></li>
</ol>
<p><strong>Detailed Summary</strong></p>
<ol>
<li>
<h4 id="moving-on-from-lat2sw-based-which-uses-dia_matrix-to-new-coo_matrix-based-sparse-weight-builder">Moving on from <code>lat2SW</code>-based (which uses <code>dia_matrix</code>) to new <code>coo_matrix</code>-based sparse weight builder</h4>
<p>Following the idea-collection issue, the first target for optimizing the interface was the weight builders. The existing approach used the <code>lat2SW</code> method which provided the main functionality for constructing a sparse matrix for the regular lattice. The main issue while using <code>lat2SW</code> was when we’re dealing with data consisting of missing values, in this case, boolean indexing was used for removing missing rows and columns from the created sparse matrix. The performance takes a hit due to boolean indexing of <code>csr_matrix</code> and this raised concerns for building weight objects for larger data. Memory consumption in <code>lat2SW</code> is also high due to the use of <code>lists</code> instead of <code>np.array</code>.</p>
<p>A proper explanation of this issue and how it was solved is given in this blog post.</p>
<ul>
<li><strong>Blog:</strong> <a href="https://mgeeeek.github.io/posts/2020/08/coding-period-last-phase-part-1/" target="_blank" rel="noopener noreffer">Coding Period: Last Phase Part 1</a>.</li>
</ul>
<p>Also, check out this <a href="https://github.com/MgeeeeK/GSoC2020/blob/master/raster%20weights%20builder.ipynb" target="_blank" rel="noopener noreffer">notebook</a> for a performance overview. These enhancements provided huge benefits both in terms of memory efficiency and faster performance. This also made the interface usable with large datasets.</p>
</li>
<li>
<h4 id="optimizing-the-addition-of-higher-order-neighbors">Optimizing the addition of higher-order neighbors</h4>
<p>In the previous section, I explained how <code>KNN</code>-based weight object was not very consistent when dealing with the raster-based data. Therefore, we decided to implement <code>higher_order</code> functionality, and 2 approaches were taken when adding the higher-order neighbors:</p>
<ul>
<li>
<p>Implementing the first approach was relatively easier than the second approach, as only a few changes were added inside the modified weights builder. An extra argument was provided which acted as a <code>threshold</code> and then using modular arithmetic conditions the algorithms added the neighbors lying inside the <code>threshold</code> radius also following contiguity criterion, though this implementation was different as it added higher order neighbors even if the lower order neighbors were missing and therefore it was more like <code>DistanceBand</code>. This thread provides some insightful discussion related to how <code>DistanceBand</code> behaves with raster data:</p>
<ul>
<li><strong>Issue:</strong> <a href="https://github.com/pysal/libpysal/issues/328" target="_blank" rel="noopener noreffer">Distance Band functionality for Raster Interface</a></li>
</ul>
</li>
<li>
<p>As for the second approach, we were able to implement a correct algorithm for <code>higher_order</code> functionality inside weight builder, this algorithm used recursion to traverse nth-order neighbors or nodes because raster can be assumed as a graph. Unfortunately, we could not incorporate <code>numba</code> and <code>multi-threading</code> to the method and therefore the algorithm was very inefficient. But after some testing, we were able to add a proper algorithm for using the method that Martin suggested in this thread.</p>
<ul>
<li><strong>Issue:</strong> <a href="https://github.com/pysal/libpysal/issues/313" target="_blank" rel="noopener noreffer">higher_order weights of &lt;= k</a></li>
</ul>
</li>
</ul>
<p>Since both approaches are different from each other we added <code>include_nas</code> argument which if <code>True</code>, computes weights using the first approach, and if <code>False</code> the builder uses the second approach. We can take a look at the visual example below which explains this more intuitively.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/40512095/91647908-7b156500-ea7e-11ea-9785-a7745bd28edc.png"
        data-srcset="https://user-images.githubusercontent.com/40512095/91647908-7b156500-ea7e-11ea-9785-a7745bd28edc.png, https://user-images.githubusercontent.com/40512095/91647908-7b156500-ea7e-11ea-9785-a7745bd28edc.png 1.5x, https://user-images.githubusercontent.com/40512095/91647908-7b156500-ea7e-11ea-9785-a7745bd28edc.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/40512095/91647908-7b156500-ea7e-11ea-9785-a7745bd28edc.png"
        title="Fig. 3" />
<em>Here we used <code>testDataArray</code> method to create a small raster data filled with random and missing values. <code>Fig. 2</code> shows the <code>Rook</code> contiguity with <code>k=1</code> which means all first-order rook neighbors are selected. <code>Fig. 3</code> shows the <code>Rook</code> contiguity with <code>k=2</code> but with <code>include_nas=False</code> which means all <code>non-missing</code> first and second-order rook neighbors are selected (this uses the second approach as described previously). <code>include_nas</code> is <code>True</code> for <code>Fig. 4</code>, we can see that in this figure all the first order neighbors are selected but while selecting second order neighbors, the method takes consideration of (missing + nonmissing) first-order neighbors.</em>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/40512095/91647911-7d77bf00-ea7e-11ea-844e-8dd547057a35.png"
        data-srcset="https://user-images.githubusercontent.com/40512095/91647911-7d77bf00-ea7e-11ea-844e-8dd547057a35.png, https://user-images.githubusercontent.com/40512095/91647911-7d77bf00-ea7e-11ea-844e-8dd547057a35.png 1.5x, https://user-images.githubusercontent.com/40512095/91647911-7d77bf00-ea7e-11ea-844e-8dd547057a35.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/40512095/91647911-7d77bf00-ea7e-11ea-844e-8dd547057a35.png"
        title="Fig. 4" />
After completion of these methods, a pull request was created targeting the master branch of <code>libpysal</code> which added optimized weights builder and <code>higher_order</code> functionality. This pull request describes how these approaches are different from each other:</p>
<ul>
<li><strong>[WIP]</strong> <a href="https://github.com/pysal/libpysal/pull/343" target="_blank" rel="noopener noreffer">Optimized raster-based weights builder</a></li>
</ul>
</li>
</ol>
<p><strong>This marked the end of the optimization phase.</strong></p>
<ol start="3">
<li>
<h4 id="adding-visualization-support-for-the-interface">Adding visualization support for the interface.</h4>
<p>Along with optimization work, we also worked on adding the support for plotting functionality for a raster-based weight object. This required some changes inside the <code>plot_spatial_weights</code> method, mainly making it work with sparse weight objects instead of dense weight objects and adding a <code>da</code> argument for passing <code>DataArray</code> object.</p>
<ul>
<li><strong>Issue:</strong> <strong>[open]</strong> <a href="https://github.com/pysal/splot/issues/112" target="_blank" rel="noopener noreffer">plotting for <code>libpysal</code> raster functionality</a></li>
<li><strong>PR:</strong> <strong>[WIP]</strong> <a href="https://github.com/pysal/splot/pull/113" target="_blank" rel="noopener noreffer">Added raster weights plotting functionality</a></li>
</ul>
<p>The visualization aspect of the project is still in progress, once this pull request gets reviewed. I&rsquo;ll add more enhancements which are listed in the issue.</p>
</li>
</ol>
<h2 id="next-phase-post-gsoc">Next Phase (post-gsoc)</h2>
<ul>
<li>Since the weight object is being refactored to remove the legacy part and adopt new features from newly available libraries like <code>pandas</code> and <code>xarray</code>. I&rsquo;ll need to reflect these changes to the interface once they are incorporated into the <code>libpysal</code>.</li>
<li>Additionally, the interface once merged will be in the alpha-testing phase and I&rsquo;m expecting new bugs to pop-in which we were not able to test. Therefore I&rsquo;ll have to be available to provide the bug fixes for a few initial months of merging the interface.</li>
<li>However optimized the weights builder can be, there will be still a chance that the program will run out of memory as the raster size increases. One ambitious idea when working on the interface was related to lazily building the weights object. I did some early explorational prototyping for this part (<a href="https://github.com/MgeeeeK/libpysal/pull/7/files" target="_blank" rel="noopener noreffer">[WIP] : Lazy weights object for raster interface</a>) but it&rsquo;ll require a massive change in the structure of the weights object probably a new class only supporting lazy operations. Once it is successfully implemented all the conversion and computation will be lazy which will allow users to use larger than memory rasters, albeit the computations will be slow.</li>
<li>Even though <code>xarray</code> provides great support for <code>Dask</code>, the project has not yet taken advantage of or support <code>dask</code> structures. It&rsquo;ll be a nice functionality to add to the interface in the future.</li>
</ul>
<h2 id="huge-thanks-to-pysal-community">Huge thanks to PySAL Community</h2>
<p>As a computer science undergrad this project was a breath of fresh air for me since I was relatively new to the PySAL library and the field of geospatial data science. I gained lots of experience working on this project especially working on somethings I wasn&rsquo;t completely familiar with.</p>
<p>I like to thank my mentors Stefanie, Dani, Levi for taking the time to review the prs, clearing my doubts, and providing me with valuable feedback which helped me along the way of building this project. I also appreciate the work of other community members working on this cool library.</p>
<p>I&rsquo;ll meet you in the new season of surviving 2020.</p>
<p>Mragank Shekhar</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 30-08-2020</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/final_report/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/pysal/">pysal</a>,&nbsp;<a href="/tags/final-report/">final report</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/cdp31/" class="prev" rel="prev" title="Coding Period: Last Phase Part 1"><i class="fas fa-angle-left fa-fw"></i>Coding Period: Last Phase Part 1</a>
            <a href="/sum_with_amz_and_arviz/" class="next" rel="next" title="Summer with Amazon and ArviZ">Summer with Amazon and ArviZ<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
    <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a
                    href="https://github.com/MgeeeeK" target="_blank">Mragank Shekhar</a></span></div>
    </div>
</footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"valine":{"appId":"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI","appKey":"WBmoGyJtbqUswvfLh6L8iEBr","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"en","pageSize":10,"placeholder":"Your comment ...","recordIP":true,"serverURLs":"https://leancloud.hugoloveit.com","visitor":true}},"data":{"id-1":"cd $HOME","id-2":"cd $HOME"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
